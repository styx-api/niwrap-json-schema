{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "mri_robust_template",
  "description": "Constructs an unbiased robust template for longitudinal volumes using an iterative method.",
  "type": "object",
  "properties": {
    "@type": {
      "const": "freesurfer/mri_robust_template"
    },
    "mov": {
      "type": "array",
      "items": {
        "type": "string",
        "x-styx-type": "file"
      },
      "title": "Movable Volumes",
      "description": "Input movable volumes to be aligned to common mean/median template (at least 2 required)."
    },
    "template": {
      "type": "string",
      "title": "Template Output",
      "description": "Output template volume (final mean/median image)."
    },
    "sat": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Outlier Sensitivity",
      "description": "Set outlier sensitivity manually. Higher values mean less sensitivity."
    },
    "satit": {
      "type": "boolean",
      "default": false,
      "title": "Auto-detect Sensitivity",
      "description": "Auto-detect good sensitivity (recommended for head or full brain scans)."
    },
    "lta": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Output Transforms",
      "description": "Output LTA transforms to template (one per input volume)."
    },
    "mapmov": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Mapped Movables",
      "description": "Output mapped and resampled images in template space (one per input volume)."
    },
    "mapmovhdr": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Header-adjusted Movables",
      "description": "Output header-adjusted movable images (no resampling, only vox2ras adjusted)."
    },
    "weights": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Outlier Weights",
      "description": "Output weight volumes in template space (0=regular, 1=outlier)."
    },
    "oneminusw": {
      "type": "boolean",
      "default": false,
      "title": "Invert Weights",
      "description": "Invert outlier weight map (0=outlier), as in earlier versions."
    },
    "average": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Average Type",
      "description": "Construct template from: 0=mean, 1=median (default 1)."
    },
    "inittp": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Initial Timepoint",
      "description": "Use timepoint number for spatial initialization (default: random). 0 constructs template from original volumes without initialization."
    },
    "fixtp": {
      "type": "boolean",
      "default": false,
      "title": "Fix Timepoint",
      "description": "Map everything to initial timepoint (init TP is not resampled)."
    },
    "iscale": {
      "type": "boolean",
      "default": false,
      "title": "Intensity Scaling",
      "description": "Enable intensity scaling (default off)."
    },
    "iscaleonly": {
      "type": "boolean",
      "default": false,
      "title": "Intensity Scaling Only",
      "description": "Only perform intensity scaling (no spatial transformation)."
    },
    "iscalein": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "string",
            "x-styx-type": "file"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Initial Intensity Scales",
      "description": "Input initial intensity scale files."
    },
    "iscaleout": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Output Intensity Scales",
      "description": "Output final intensity scale files (will activate --iscale)."
    },
    "transonly": {
      "type": "boolean",
      "default": false,
      "title": "Translation Only",
      "description": "Find 3 parameter translation only."
    },
    "affine": {
      "type": "boolean",
      "default": false,
      "title": "Affine Transform",
      "description": "Find 12 parameter affine transform."
    },
    "ixforms": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "string",
            "x-styx-type": "file"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Initial Transforms",
      "description": "Use initial LTA transforms on source ('id' for identity)."
    },
    "masks": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "string",
            "x-styx-type": "file"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Input Masks",
      "description": "Input mask volumes applied to movable images."
    },
    "vox2vox": {
      "type": "boolean",
      "default": false,
      "title": "Vox2Vox Output",
      "description": "Output VOX2VOX LTA file (default is RAS2RAS)."
    },
    "leastsquares": {
      "type": "boolean",
      "default": false,
      "title": "Least Squares",
      "description": "Use least squares instead of robust M-estimator (for testing only)."
    },
    "noit": {
      "type": "boolean",
      "default": false,
      "title": "No Iteration",
      "description": "Do not iterate, just create first template."
    },
    "maxit": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Max Iterations",
      "description": "Maximum number of template iterations (default: 6 if >2 timepoints, 5 otherwise)."
    },
    "highit": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "High Resolution Iterations",
      "description": "Maximum number of iterations on highest resolution (default: -1, use maxit)."
    },
    "epsit": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Iteration Convergence Threshold",
      "description": "Stop template iterations when all transform updates fall below this value (default: -1.0, disabled)."
    },
    "pairmaxit": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Pairwise Max Iterations",
      "description": "Maximum number of iterations for pairwise registrations (default: 5)."
    },
    "pairepsit": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Pairwise Convergence Threshold",
      "description": "Stop pairwise registration iterations when transform updates fall below this value (default: 0.01)."
    },
    "subsample": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Subsample Threshold",
      "description": "Subsample if voxel dimension exceeds this value on all axes (default: -1, disabled)."
    },
    "nomulti": {
      "type": "boolean",
      "default": false,
      "title": "Disable Multi-resolution",
      "description": "Do not use multi-resolution (process highest resolution only)."
    },
    "floattype": {
      "type": "boolean",
      "default": false,
      "title": "Convert to Float",
      "description": "Convert images to float internally (default: keep input type)."
    },
    "finalnearest": {
      "type": "boolean",
      "default": false,
      "title": "Nearest Neighbor Interpolation",
      "description": "Use nearest neighbor interpolation when creating the final average."
    },
    "doubleprec": {
      "type": "boolean",
      "default": false,
      "title": "Double Precision",
      "description": "Use double precision instead of float internally (large memory usage)."
    },
    "cras": {
      "type": "boolean",
      "default": false,
      "title": "Center at CRAS",
      "description": "Center template at average CRAS instead of average barycenter."
    },
    "res_thresh": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Resolution Threshold",
      "description": "Volume resolution threshold in mm (default: 0.01)."
    },
    "frobnorm_thresh": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Frobenius Norm Threshold",
      "description": "Matrix Frobenius norm threshold (default: 0.0001)."
    },
    "conform": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Conform Template",
      "description": "Output conformed template (256^3, 1mm isotropic voxels)."
    },
    "seed": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Random Seed",
      "description": "Set random seed for target selection (default: 0)."
    },
    "allow_diff_vox_size": {
      "type": "boolean",
      "default": false,
      "title": "Allow Different Voxel Sizes",
      "description": "Allow input volumes with different voxel sizes."
    },
    "threads": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Threads",
      "description": "Set number of OpenMP threads."
    },
    "debug": {
      "type": "boolean",
      "default": false,
      "title": "Debug Mode",
      "description": "Show debug output."
    }
  },
  "additionalProperties": false,
  "required": [
    "mov",
    "template",
    "@type"
  ]
}