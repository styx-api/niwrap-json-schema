{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "tckmap",
  "description": "Use track data as a form of contrast for producing a high-resolution image.\n\nNote: if you run into limitations with RAM usage, make sure you output the results to a .mif file or .mih / .dat file pair - this will avoid the allocation of an additional buffer to store the output for write-out.\n\nReferences:\n\n* For TDI or DEC TDI:\nCalamante, F.; Tournier, J.-D.; Jackson, G. D. & Connelly, A. Track-density imaging (TDI): Super-resolution white matter imaging using whole-brain track-density mapping. NeuroImage, 2010, 53, 1233-1243\n\n* If using -contrast length and -stat_vox mean:\nPannek, K.; Mathias, J. L.; Bigler, E. D.; Brown, G.; Taylor, J. D. & Rose, S. E. The average pathlength map: A diffusion MRI tractography-derived index for studying brain pathology. NeuroImage, 2011, 55, 133-141\n\n* If using -dixel option with TDI contrast only:\nSmith, R.E., Tournier, J-D., Calamante, F., Connelly, A. A novel paradigm for automated segmentation of very large whole-brain probabilistic tractography data sets. In proc. ISMRM, 2011, 19, 673\n\n* If using -dixel option with any other contrast:\nPannek, K., Raffelt, D., Salvado, O., Rose, S. Incorporating directional information in diffusion tractography derived maps: angular track imaging (ATI). In Proc. ISMRM, 2012, 20, 1912\n\n* If using -tod option:\nDhollander, T., Emsell, L., Van Hecke, W., Maes, F., Sunaert, S., Suetens, P. Track Orientation Density Imaging (TODI) and Track Orientation Distribution (TOD) based tractography. NeuroImage, 2014, 94, 312-336\n\n* If using other contrasts / statistics:\nCalamante, F.; Tournier, J.-D.; Smith, R. E. & Connelly, A. A generalised framework for super-resolution track-weighted imaging. NeuroImage, 2012, 59, 2494-2503\n\n* If using -precise mapping option:\nSmith, R. E.; Tournier, J.-D.; Calamante, F. & Connelly, A. SIFT: Spherical-deconvolution informed filtering of tractograms. NeuroImage, 2013, 67, 298-312 (Appendix 3)",
  "type": "object",
  "properties": {
    "@type": {
      "const": "mrtrix/tckmap"
    },
    "template": {
      "anyOf": [
        {
          "type": "string",
          "x-styx-type": "file"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "template",
      "description": "an image file to be used as a template for the output (the output image will have the same transform and field of view)."
    },
    "vox": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "number"
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "vox",
      "description": "provide either an isotropic voxel size (in mm), or comma-separated list of 3 voxel dimensions."
    },
    "datatype": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "datatype",
      "description": "specify output image data type."
    },
    "dec": {
      "type": "boolean",
      "default": false,
      "title": "dec",
      "description": "perform track mapping in directionally-encoded colour (DEC) space"
    },
    "dixel": {
      "anyOf": [
        {
          "anyOf": [
            {
              "type": "object",
              "properties": {
                "@type": {
                  "const": "VariousString"
                },
                "obj": {
                  "type": "string",
                  "title": "Object",
                  "description": "String object."
                }
              },
              "additionalProperties": false,
              "required": [
                "@type",
                "obj"
              ]
            },
            {
              "type": "object",
              "properties": {
                "@type": {
                  "const": "VariousFile"
                },
                "obj": {
                  "type": "string",
                  "x-styx-type": "file",
                  "title": "Object",
                  "description": "File object."
                }
              },
              "additionalProperties": false,
              "required": [
                "@type",
                "obj"
              ]
            }
          ]
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "dixel",
      "description": "map streamlines to dixels within each voxel; requires either a number of dixels (references an internal direction set), or a path to a text file containing a set of directions stored as azimuth/elevation pairs"
    },
    "tod": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "tod",
      "description": "generate a Track Orientation Distribution (TOD) in each voxel; need to specify the maximum spherical harmonic degree lmax to use when generating Apodised Point Spread Functions"
    },
    "contrast": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "contrast",
      "description": "define the desired form of contrast for the output image\nOptions are: tdi, length, invlength, scalar_map, scalar_map_count, fod_amp, curvature, vector_file (default: tdi)"
    },
    "image": {
      "anyOf": [
        {
          "type": "string",
          "x-styx-type": "file"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "image",
      "description": "provide the scalar image map for generating images with 'scalar_map' / 'scalar_map_count' contrast, or the spherical harmonics image for 'fod_amp' contrast"
    },
    "vector_file": {
      "anyOf": [
        {
          "type": "string",
          "x-styx-type": "file"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "vector_file",
      "description": "provide the vector data file for generating images with 'vector_file' contrast"
    },
    "stat_vox": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "stat_vox",
      "description": "define the statistic for choosing the final voxel intensities for a given contrast type given the individual values from the tracks passing through each voxel. \nOptions are: sum, min, mean, max (default: sum)"
    },
    "stat_tck": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "stat_tck",
      "description": "define the statistic for choosing the contribution to be made by each streamline as a function of the samples taken along their lengths. \nOnly has an effect for 'scalar_map', 'fod_amp' and 'curvature' contrast types. \nOptions are: sum, min, mean, max, median, mean_nonzero, gaussian, ends_min, ends_mean, ends_max, ends_prod (default: mean)"
    },
    "fwhm_tck": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "fwhm_tck",
      "description": "when using gaussian-smoothed per-track statistic, specify the desired full-width half-maximum of the Gaussian smoothing kernel (in mm)"
    },
    "map_zero": {
      "type": "boolean",
      "default": false,
      "title": "map_zero",
      "description": "if a streamline has zero contribution based on the contrast & statistic, typically it is not mapped; use this option to still contribute to the map even if this is the case (these non-contributing voxels can then influence the mean value in each voxel of the map)"
    },
    "backtrack": {
      "type": "boolean",
      "default": false,
      "title": "backtrack",
      "description": "when using -stat_tck ends_*, if the streamline endpoint is outside the FoV, backtrack along the streamline trajectory until an appropriate point is found"
    },
    "upsample": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "upsample",
      "description": "upsample the tracks by some ratio using Hermite interpolation before mappping\n(If omitted, an appropriate ratio will be determined automatically)"
    },
    "precise": {
      "type": "boolean",
      "default": false,
      "title": "precise",
      "description": "use a more precise streamline mapping strategy, that accurately quantifies the length through each voxel (these lengths are then taken into account during TWI calculation)"
    },
    "ends_only": {
      "type": "boolean",
      "default": false,
      "title": "ends_only",
      "description": "only map the streamline endpoints to the image"
    },
    "tck_weights_in": {
      "anyOf": [
        {
          "type": "string",
          "x-styx-type": "file"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "tck_weights_in",
      "description": "specify a text scalar file containing the streamline weights"
    },
    "info": {
      "type": "boolean",
      "default": false,
      "title": "info",
      "description": "display information messages."
    },
    "quiet": {
      "type": "boolean",
      "default": false,
      "title": "quiet",
      "description": "do not display information messages or progress status; alternatively, this can be achieved by setting the MRTRIX_QUIET environment variable to a non-empty string."
    },
    "debug": {
      "type": "boolean",
      "default": false,
      "title": "debug",
      "description": "display debugging messages."
    },
    "force": {
      "type": "boolean",
      "default": false,
      "title": "force",
      "description": "force overwrite of output files (caution: using the same file as input and output might cause unexpected behaviour)."
    },
    "nthreads": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "nthreads",
      "description": "use this number of threads in multi-threaded applications (set to 0 to disable multi-threading)."
    },
    "config": {
      "anyOf": [
        {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "@type": {
                "const": "config"
              },
              "key": {
                "type": "string",
                "title": "key",
                "description": "temporarily set the value of an MRtrix config file entry."
              },
              "value": {
                "type": "string",
                "title": "value",
                "description": "temporarily set the value of an MRtrix config file entry."
              }
            },
            "additionalProperties": false,
            "title": "config",
            "description": "temporarily set the value of an MRtrix config file entry.",
            "required": [
              "key",
              "value"
            ]
          }
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "config",
      "description": "temporarily set the value of an MRtrix config file entry."
    },
    "help": {
      "type": "boolean",
      "default": false,
      "title": "help",
      "description": "display this information page and exit."
    },
    "version": {
      "type": "boolean",
      "default": false,
      "title": "version",
      "description": "display version information and exit."
    },
    "tracks": {
      "type": "string",
      "x-styx-type": "file",
      "title": "tracks",
      "description": "the input track file."
    },
    "output": {
      "type": "string",
      "title": "output",
      "description": "the output track-weighted image"
    }
  },
  "additionalProperties": false,
  "required": [
    "tracks",
    "output",
    "@type"
  ]
}