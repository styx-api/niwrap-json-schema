{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "antsAtroposN4.sh iterates between N4 <-> Atropos to improve segmentation results.",
  "type": "object",
  "properties": {
    "__STYXTYPE__": {
      "const": "antsAtroposN4.sh"
    },
    "image_dimension": {
      "type": "integer",
      "title": "Image Dimension",
      "description": "2 or 3, for 2- or 3-dimensional image."
    },
    "input_image": {
      "type": "string",
      "title": "Input Image",
      "description": "Anatomical image, typically T1. If more than one anatomical image is specified, subsequent images are also used during the segmentation process."
    },
    "mask_image": {
      "type": "string",
      "title": "Mask Image",
      "description": "Binary mask defining the region of interest."
    },
    "number_of_classes": {
      "type": "integer",
      "title": "Number of Segmentation Classes",
      "description": "Number of classes defining the segmentation."
    },
    "output_prefix": {
      "type": "string",
      "title": "Output Prefix",
      "description": "The following images are created: {output_prefix}N4Corrected.{output_suffix}, {output_prefix}Segmentation.{output_suffix}, {output_prefix}SegmentationPosteriors.{output_suffix}"
    },
    "max_n4_atropos_iterations": {
      "anyOf": [
        {
          "type": "integer",
          "minimum": 1
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Max. N4 <-> Atropos Iterations",
      "description": "Maximum number of (outer loop) iterations between N4 <-> Atropos (default = 15)."
    },
    "max_atropos_iterations": {
      "anyOf": [
        {
          "type": "integer",
          "minimum": 1
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Max. Atropos Iterations",
      "description": "Maximum number of (inner loop) iterations in Atropos (default = 3)."
    },
    "segmentation_priors": {
      "type": "object",
      "properties": {
        "__STYXTYPE__": {
          "const": "segmentation_priors"
        },
        "segmentation_priors_pattern": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Segmentation Priors",
          "description": "Prior probability images initializing the segmentation. Specified using c-style formatting, e.g. -p labelsPriors%02d.nii.gz. If this is not specified, k-means initialization is used instead."
        },
        "segmentation_priors_folder": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Segmentation Priors Folder",
          "description": "Included so."
        }
      },
      "additionalProperties": false,
      "description": "Prior probability images initializing the segmentation. Specified using c-style formatting, e.g. -p labelsPriors%02d.nii.gz. If this is not specified, k-means initialization is used instead."
    },
    "mrf": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "MRF",
      "description": "Specifies MRF prior (of the form '[ weight,neighborhood ]', e.g. '[ 0.1,1x1x1 ]' which is default)."
    },
    "denoise_anatomical_images": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Denoise Anatomical Images",
      "description": "Denoise anatomical images (1) or not (0) (default = 1)."
    },
    "posterior_formulation": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Posterior Formulation",
      "description": "Posterior formulation and whether or not to use mixture model proportions. e.g 'Socrates[ 1 ]' (default) or 'Aristotle[ 1 ]'.  Choose the latter if you want to use the distance priors, see also the -l option for label propagation control (default = 'Socrates[ 1 ]')."
    },
    "label_propagation": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Label Propagation",
      "description": "Incorporate a distance prior into the 'Aristotle' posterior formulation. Should be of the form 'label[ lambda,boundaryProbability ]' where label is a value of 1,2,3,... denoting label ID. The label probability for anything outside the current label\n\n  = boundaryProbability * exp( -lambda * distanceFromBoundary )\n\nIntuitively, smaller lambda values will increase the spatial capture range of the distance prior. To apply to all label values, simply omit specifying the label, i.e. -l '[ lambda,boundaryProbability ]'."
    },
    "posterior_label_for_n4_weight_mask": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Posterior Label for N4 Weight Mask",
      "description": "Which posterior probability image should be used to define the N4 weight mask. Can also specify multiple posteriors in which case the chosen posteriors are combined."
    },
    "image_file_suffix": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Image File Suffix",
      "description": "Any of the standard ITK IO formats e.g. nrrd, nii.gz (default), mhd."
    },
    "keep_temporary_files": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Keep Temporary Files",
      "description": "Keep temporary files on disk (1) or delete them (0) (default = 0)."
    },
    "use_random_seeding": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Use Random Seeding",
      "description": "Use random number generated from system clock in Atropos (default = 1)."
    },
    "atropos_segmentation_prior_weight": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Atropos Prior Segmentation Weight",
      "description": "Atropos spatial prior probability weight for the segmentation (default = 0.25)."
    },
    "n4_convergence": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "N4 Convergence",
      "description": "Convergence parameters for N4, see '-c' option in N4BiasFieldCorrection (default = [50x50x50x50,0.0000001])."
    },
    "n4_shrink_factor": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "N4 Shrink Factor",
      "description": "Shrink factor for N4 (default = 4)."
    },
    "n4_bspline_params": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "N4 B-spline Parameters",
      "description": "N4 b-spline specification, see '-b' option in N4BiasFieldCorrection (default = [200,0,0,0])."
    },
    "atropos_segmentation_icm": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Atropos ICM",
      "description": "ICM parameters for segmentation, see '-g' option in Atropos (default = [1,1])."
    },
    "atropos_segmentation_use_euclidean_distance": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Atropos Use Euclidean Distance",
      "description": "Use euclidean distances in distance prior formulation (1) or not (0), see Atropos usage for details (default = 1)."
    },
    "test_debug_mode": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Test / Debug Mode",
      "description": "If > 0, attempts to continue after errors."
    }
  },
  "additionalProperties": false,
  "required": [
    "image_dimension",
    "input_image",
    "mask_image",
    "number_of_classes",
    "output_prefix",
    "segmentation_priors"
  ]
}