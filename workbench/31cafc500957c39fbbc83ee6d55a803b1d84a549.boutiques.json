{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Find extrema in a metric file.\n\nFinds extrema in a metric file, such that no two extrema of the same type are within <distance> of each other.  The extrema are labeled as -1 for minima, 1 for maxima, 0 otherwise.  If -only-maxima or -only-minima is specified, then it will ignore extrema not of the specified type.  These options are mutually exclusive.\n\nIf -roi is specified, not only is data outside the roi not used, but any vertex on the edge of the ROI will never be counted as an extrema, in case the ROI cuts across a gradient, which would otherwise generate extrema where there should be none.\n\nIf -sum-columns is specified, these extrema columns are summed, and the output has a single column with this result.\n\nBy default, a datapoint is an extrema only if it is more extreme than every other datapoint that is within <distance> from it.  If -consolidate-mode is used, it instead starts by finding all datapoints that are more extreme than their immediate neighbors, then while there are any extrema within <distance> of each other, take the two extrema closest to each other and merge them into one by a weighted average based on how many original extrema have been merged into each.\n\nBy default, all input columns are used with no smoothing, use -column to specify a single column to use, and -presmooth to smooth the input before finding the extrema.",
  "type": "object",
  "properties": {
    "@type": {
      "const": "workbench.metric-extrema"
    },
    "surface": {
      "type": "string",
      "title": "surface",
      "description": "the surface to use for distance information"
    },
    "metric_in": {
      "type": "string",
      "title": "metric_in",
      "description": "the metric to find the extrema of"
    },
    "distance": {
      "type": "number",
      "title": "distance",
      "description": "the minimum distance between identified extrema of the same type"
    },
    "metric_out": {
      "type": "string",
      "title": "metric_out",
      "description": "the output extrema metric"
    },
    "presmooth": {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "@type": {
              "const": "presmooth"
            },
            "kernel": {
              "type": "number",
              "title": "kernel",
              "description": "the size of the gaussian smoothing kernel in mm, as sigma by default"
            },
            "opt_fwhm": {
              "type": "boolean",
              "default": false,
              "title": "opt_fwhm",
              "description": "kernel size is FWHM, not sigma"
            }
          },
          "additionalProperties": false,
          "description": "smooth the metric before finding extrema",
          "required": [
            "kernel"
          ]
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "smooth the metric before finding extrema"
    },
    "opt_roi_roi_metric": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "opt_roi_roi_metric",
      "description": "ignore values outside the selected area: the area to find extrema in, as a metric"
    },
    "threshold": {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "@type": {
              "const": "threshold"
            },
            "low": {
              "type": "number",
              "title": "low",
              "description": "the largest value to consider for being a minimum"
            },
            "high": {
              "type": "number",
              "title": "high",
              "description": "the smallest value to consider for being a maximum"
            }
          },
          "additionalProperties": false,
          "description": "ignore small extrema",
          "required": [
            "low",
            "high"
          ]
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "ignore small extrema"
    },
    "opt_sum_columns": {
      "type": "boolean",
      "default": false,
      "title": "opt_sum_columns",
      "description": "output the sum of the extrema columns instead of each column separately"
    },
    "opt_consolidate_mode": {
      "type": "boolean",
      "default": false,
      "title": "opt_consolidate_mode",
      "description": "use consolidation of local minima instead of a large neighborhood"
    },
    "opt_only_maxima": {
      "type": "boolean",
      "default": false,
      "title": "opt_only_maxima",
      "description": "only find the maxima"
    },
    "opt_only_minima": {
      "type": "boolean",
      "default": false,
      "title": "opt_only_minima",
      "description": "only find the minima"
    },
    "opt_column_column": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "opt_column_column",
      "description": "select a single column to find extrema in: the column number or name"
    }
  },
  "additionalProperties": false,
  "required": [
    "surface",
    "metric_in",
    "distance",
    "metric_out"
  ]
}