{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "surface-distortion",
  "description": "MEASURE DISTORTION BETWEEN SURFACES.\n\nThis command, when not using -caret5-method, -edge-method, or -local-affine-method, is equivalent to using -surface-vertex-areas on each surface, smoothing both output metrics with the GEO_GAUSS_EQUAL method on the surface they came from if -smooth is specified, and then using the formula 'ln(distorted/reference)/ln(2)' on the smoothed results.\n\nWhen using -caret5-method, it uses the surface distortion method from caret5, which takes the base 2 log of the ratio of tile areas, then averages those results at each vertex, and then smooths the result on the reference surface.\n\nWhen using -edge-method, the -smooth option is ignored, and the output at each vertex is the average of 'abs(ln(refEdge/distortEdge)/ln(2))' over all edges connected to the vertex.\n\nWhen using -local-affine-method, the -smooth option is ignored.  The output is two columns, the first is the area distortion ratio, and the second is anisotropic strain.  These are calculated by an affine transform between matching triangles, and then averaged across the triangles of a vertex.",
  "type": "object",
  "properties": {
    "@type": {
      "const": "workbench/surface-distortion"
    },
    "metric-out": {
      "type": "string",
      "description": "the output distortion metric"
    },
    "smooth": {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "@type": {
              "const": "smooth"
            },
            "sigma": {
              "type": "number",
              "description": "the size of the smoothing kernel in mm, as sigma by default"
            },
            "fwhm": {
              "type": "boolean",
              "default": false,
              "description": "kernel size is FWHM, not sigma"
            }
          },
          "additionalProperties": false,
          "description": "smooth the area data",
          "required": [
            "sigma"
          ]
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "smooth the area data"
    },
    "match-surface-area": {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "@type": {
              "const": "match-surface-area"
            },
            "roi-metric": {
              "anyOf": [
                {
                  "type": "string",
                  "x-styx-type": "file"
                },
                {
                  "type": "null"
                }
              ],
              "default": null,
              "description": "only use the surface area within a given ROI (e.g., to exclude the medial wall)\n\nthe ROI to use, as a metric file"
            }
          },
          "additionalProperties": false,
          "description": "isotropically rescale the distorted surface so that it has the same surface area as the reference surface"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "isotropically rescale the distorted surface so that it has the same surface area as the reference surface"
    },
    "caret5-method": {
      "type": "boolean",
      "default": false,
      "description": "use the surface distortion method from caret5"
    },
    "edge-method": {
      "type": "boolean",
      "default": false,
      "description": "calculate distortion of edge lengths rather than areas"
    },
    "log2": {
      "anyOf": [
        {
          "type": "boolean"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "calculate distortion by the local affines between triangles\n\napply base-2 log transform"
    },
    "surface-reference": {
      "type": "string",
      "x-styx-type": "file",
      "description": "the reference surface"
    },
    "surface-distorted": {
      "type": "string",
      "x-styx-type": "file",
      "description": "the distorted surface"
    }
  },
  "additionalProperties": false,
  "required": [
    "metric-out",
    "surface-reference",
    "surface-distorted",
    "@type"
  ]
}