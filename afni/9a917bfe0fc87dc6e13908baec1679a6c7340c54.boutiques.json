{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Computes 6 principal direction tensors from multiple gradient vectors and corresponding DTI image volumes.",
  "type": "object",
  "properties": {
    "@type": {
      "const": "afni.3dDWItoDT"
    },
    "gradient_file": {
      "type": "string",
      "title": "Gradient file",
      "description": "A 1D file of the gradient vectors with lines of ASCII floats (Gxi, Gyi, Gzi) or a 1D file of b-matrix elements."
    },
    "dataset": {
      "type": "string",
      "title": "DTI dataset",
      "description": "A 3D bucket dataset with Np+1 sub-briks where the first sub-brik is the volume acquired with no diffusion weighting."
    },
    "prefix": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Output prefix",
      "description": "Output dataset prefix name. Default is 'DT'."
    },
    "automask": {
      "type": "boolean",
      "default": false,
      "title": "Automatic mask",
      "description": "Mask dataset so that tensors are computed only for high-intensity (presumably brain) voxels."
    },
    "mask": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Mask dataset",
      "description": "Use this dataset as mask to include/exclude voxels."
    },
    "bmatrix_NZ": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "B-matrix NZ",
      "description": "Input dataset is b-matrix, not gradient directions, and there is no row of zeros at the top of the file."
    },
    "bmatrix_Z": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "B-matrix Z",
      "description": "Similar to '-bmatrix_NZ' but first row of the file is all zeros."
    },
    "bmatrix_FULL": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "B-matrix FULL",
      "description": "Same as '-bmatrix_Z' but with a more intuitive name."
    },
    "scale_out_1000": {
      "type": "boolean",
      "default": false,
      "title": "Scale output by 1000",
      "description": "Increase output parameters with physical units by multiplying them by 1000."
    },
    "bmax_ref": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Reference b-value",
      "description": "Flag the reference b-value if it is greater than zero."
    },
    "nonlinear": {
      "type": "boolean",
      "default": false,
      "title": "Nonlinear computation",
      "description": "Compute iterative solution to avoid negative eigenvalues. This is the default method."
    },
    "linear": {
      "type": "boolean",
      "default": false,
      "title": "Linear computation",
      "description": "Compute simple linear solution."
    },
    "reweight": {
      "type": "boolean",
      "default": false,
      "title": "Recompute weight factors",
      "description": "Recompute weight factors at end of iterations and restart."
    },
    "max_iter": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Maximum iterations",
      "description": "Maximum number of iterations for convergence. Default is 10."
    },
    "max_iter_rw": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Max iterations after reweighting",
      "description": "Max number of iterations after reweighting. Default is 5."
    },
    "eigs": {
      "type": "boolean",
      "default": false,
      "title": "Compute Eigen parameters",
      "description": "Compute eigenvalues, eigenvectors, fractional anisotropy, and mean diffusivity in sub-briks 6-19."
    },
    "debug_briks": {
      "type": "boolean",
      "default": false,
      "title": "Add debugging sub-briks",
      "description": "Add sub-briks with error functional, original error, number of steps to convergence, and modeled B0 volume."
    },
    "cumulative_wts": {
      "type": "boolean",
      "default": false,
      "title": "Show weight factors",
      "description": "Show overall weight factors for each gradient level."
    },
    "verbose": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Verbose",
      "description": "Print convergence steps every nnnnn voxels."
    },
    "drive_afni": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "AFNI drive",
      "description": "Show convergence graphs every nnnnn voxels. AFNI must have NIML communications on."
    },
    "sep_dsets": {
      "type": "boolean",
      "default": false,
      "title": "Separate datasets",
      "description": "Save tensor, eigenvalues, vectors, FA, MD in separate datasets."
    },
    "csf_val": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "CSF diffusivity",
      "description": "Assign diffusivity value to DWI data where the mean values for b=0 volumes is less than the mean of the remaining volumes at each voxel."
    },
    "min_bad_md": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Minimum bad MD value",
      "description": "Change the min MD value used as a 'badness check' for tensor fits."
    },
    "csf_fa": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "CSF FA value",
      "description": "Assign a specific FA value to CSF voxels."
    },
    "opt": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Optimization method",
      "description": "Optimization method: 'powell', 'gradient', or 'hybrid'."
    },
    "mean_b0": {
      "type": "boolean",
      "default": false,
      "title": "Use mean b=0",
      "description": "Use mean of all b=0 volumes for linear computation and initial linear for nonlinear method."
    }
  },
  "additionalProperties": false,
  "required": [
    "gradient_file",
    "dataset"
  ]
}